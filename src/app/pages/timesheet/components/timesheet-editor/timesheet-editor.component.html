<shared-card [title]="'timesheet.addTimeSheet' | translate" borderRadius="20">
  <form [formGroup]="form" body (ngSubmit)="submit()">
    <p-table
      [value]="getFormArray.controls"
      dataKey="id"
      [tableStyle]="{ 'min-width': '50rem' }"
      [resizableColumns]="true"
      (onSort)="onSort($event)"
      [(selection)]="selectedRows"
    >
      <ng-template pTemplate="header">
        <tr>
          <th style="width: 4rem">
            <p-tableHeaderCheckbox></p-tableHeaderCheckbox>
          </th>
          <ng-container *ngFor="let col of getColumns(columnsLocalized)">
            <th
              *ngIf="!col.sortable"
              [ngStyle]="col?.style || { 'min-width': '200px' }"
            >
              {{ col.header }}
            </th>
            <th
              *ngIf="col.sortable"
              [pSortableColumn]="col.field"
              [ngStyle]="col?.style || { 'min-width': '200px' }"
            >
              {{ col.header }}
              <p-sortIcon [field]="col.field"></p-sortIcon>
            </th>
          </ng-container>
        </tr>
      </ng-template>
      <ng-template pTemplate="body" let-row let-rowIndex="rowIndex">
        <ng-container formArrayName="data">
          <tr [formGroupName]="rowIndex">
            <td>
              <p-tableCheckbox [value]="row.value"></p-tableCheckbox>
            </td>
            <td>
              <app-stop-watch
                [stopInterval]="row.get('timing').value"
                (onStart)="onStart($event, rowIndex)"
                (onStop)="onStop(rowIndex)"
              ></app-stop-watch>
            </td>
            <td>
              <p-calendar
                formControlName="date"
                appendTo="body"
                [baseZIndex]="1009"
              ></p-calendar>
            </td>
            <td>
              <p-dropdown
                formControlName="matter"
                label=""
                [options]="matters"
                placeholder="Any"
                appendTo="body"
                (onChange)="selectMatter($event, rowIndex)"
              >
              </p-dropdown>
            </td>
            <td>
              <input
                type="text"
                formControlName="clientName"
                pInputText
                readonly
                class="w-75"
              />
            </td>
            <td>
              <p-dropdown
                formControlName="laywer"
                label=""
                [options]="laywers"
                placeholder="Any"
                appendTo="body"
              >
              </p-dropdown>
            </td>
            <td>
              <p-dropdown
                formControlName="task"
                label=""
                [options]="tasks"
                placeholder="Any"
                appendTo="body"
              >
              </p-dropdown>
            </td>
            <td>
              <input
                type="number"
                step="0.1"
                formControlName="hours"
                pInputText
              />
            </td>
            <td>
              <input type="number" formControlName="rate" pInputText />
            </td>
            <td>
              {{ amount }}
            </td>
            <td>
              <textarea
                rows="1"
                pInputTextarea
                formControlName="explanation"
                (input)="addRow()"
              ></textarea>
            </td>

            <td>
              <textarea
                rows="1"
                pInputTextarea
                formControlName="notes"
              ></textarea>
            </td>
            <td>
              <button class="text-danger bg-transparent border-0 p-2">
                <i class="pi pi-trash fs-4" (click)="onDeleteRow(rowIndex)"></i>
              </button>
            </td>
          </tr>
        </ng-container>
      </ng-template>
    </p-table>
    <div class="mt-4 text-end">
      <p-button
        [loading]="isSubmit"
        styleClass="p-button-primary d-block py-3"
        type="submit"
        label="{{ 'btn.submit' | translate }}"
      ></p-button>
    </div>
  </form>
</shared-card>
